% Chronologie de la cosmologie moderne (post relativité)
% Evenements seulement, succinct
% (découvertes majeures)

% TODO:
% - Steady universe
% - MQ age univ <~= 1/H0

\documentclass[10pt]{article}

%\usepackage[paperwidth=297mm,%
%    paperheight=420mm,%
%    tmargin=7.5mm,%
%    rmargin=7.5mm,%
%    bmargin=7.5mm,%
%    lmargin=7.5mm,
%    vscale=1,%
%    hscale=1]{geometry}
\usepackage[a3paper,margin=5mm]{geometry}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{tikz}

\usetikzlibrary{arrows, calc, decorations.markings, positioning}

\pagestyle{empty}

\makeatletter
\newenvironment{timeline}[6]{%
    % #1 is startyear
    % #2 is tlendyear
    % #3 is yearcolumnwidth
    % #4 is rulecolumnwidth
    % #5 is entrycolumnwidth
    % #6 is timelineheight

    \newcommand{\startyear}{#1}
    \newcommand{\tlendyear}{#2}

    \newcommand{\yearcolumnwidth}{#3}
    \newcommand{\rulecolumnwidth}{#4}
    \newcommand{\entrycolumnwidth}{#5}
    \newcommand{\timelineheight}{#6}

    \newcommand{\templength}{}

    \newcommand{\entrycounter}{0}

    % http://tex.stackexchange.com/questions/85528/checking-whether-or-not-a-node-has-been-previously-defined
    % http://tex.stackexchange.com/questions/37709/how-can-i-know-if-a-node-is-already-defined
    \long\def\ifnodedefined##1##2##3{%
        \@ifundefined{pgf@sh@ns@##1}{##3}{##2}%
    }

    \newcommand{\ifnodeundefined}[2]{%
        \ifnodedefined{##1}{}{##2}
    }

    \newcommand{\drawtimeline}{%
        \draw[timelinerule] (\yearcolumnwidth+5pt, 0pt) -- (\yearcolumnwidth+5pt, -\timelineheight);
        \draw (\yearcolumnwidth+0pt, -10pt) -- (\yearcolumnwidth+10pt, -10pt);
        \draw (\yearcolumnwidth+0pt, -\timelineheight+15pt) -- (\yearcolumnwidth+10pt, -\timelineheight+15pt);

        \pgfmathsetlengthmacro{\templength}{neg(add(multiply(subtract(\startyear, \startyear), divide(subtract(\timelineheight, 25), subtract(\tlendyear, \startyear))), 10))}
        \node[year] (year-\startyear) at (\yearcolumnwidth, \templength) {\startyear};

        \pgfmathsetlengthmacro{\templength}{neg(add(multiply(subtract(\tlendyear, \startyear), divide(subtract(\timelineheight, 25), subtract(\tlendyear, \startyear))), 10))}
        \node[year] (year-\tlendyear) at (\yearcolumnwidth, \templength) {\tlendyear};
    }

    \newcommand{\entry}[2]{%
        % #1 is the year
        % #2 is the entry text

        \pgfmathtruncatemacro{\lastentrycount}{\entrycounter}
        \pgfmathtruncatemacro{\entrycounter}{\entrycounter + 1}

        \ifdim \lastentrycount pt > 0 pt%
            \node[entry] (entry-\entrycounter) [below of=entry-\lastentrycount] {##2};
        \else%
            \pgfmathsetlengthmacro{\templength}{neg(add(multiply(subtract(\startyear, \startyear), divide(subtract(\timelineheight, 25), subtract(\tlendyear, \startyear))), 10))}
            \node[entry] (entry-\entrycounter) at (\yearcolumnwidth+\rulecolumnwidth+10pt, \templength) {##2};
        \fi

        \ifnodeundefined{year-##1}{%
            \pgfmathsetlengthmacro{\templength}{neg(add(multiply(subtract(##1, \startyear), divide(subtract(\timelineheight, 25), subtract(\tlendyear, \startyear))), 10))}
            \draw (\yearcolumnwidth+2.5pt, \templength) -- (\yearcolumnwidth+7.5pt, \templength);
            \node[year] (year-##1) at (\yearcolumnwidth, \templength) {##1};
        }

        \draw ($(year-##1.east)+(2.5pt, 0pt)$) -- ($(year-##1.east)+(7.5pt, 0pt)$) -- ($(entry-\entrycounter.west)-(5pt,0)$) -- (entry-\entrycounter.west);
    }

    \newcommand{\plainentry}[2]{% plainentry won't print date in the timeline
        % #1 is the year
        % #2 is the entry text

        \pgfmathtruncatemacro{\lastentrycount}{\entrycounter}
        \pgfmathtruncatemacro{\entrycounter}{\entrycounter + 1}

        \ifdim \lastentrycount pt > 0 pt%
            \node[entry] (entry-\entrycounter) [below of=entry-\lastentrycount] {##2};
        \else%
            \pgfmathsetlengthmacro{\templength}{neg(add(multiply(subtract(\startyear, \startyear), divide(subtract(\timelineheight, 25), subtract(\tlendyear, \startyear))), 10))}
            \node[entry] (entry-\entrycounter) at (\yearcolumnwidth+\rulecolumnwidth+10pt, \templength) {##2};
        \fi

        \ifnodeundefined{invisible-year-##1}{%
            \pgfmathsetlengthmacro{\templength}{neg(add(multiply(subtract(##1, \startyear), divide(subtract(\timelineheight, 25), subtract(\tlendyear, \startyear))), 10))}
            \draw (\yearcolumnwidth+2.5pt, \templength) -- (\yearcolumnwidth+7.5pt, \templength);
            \node[year] (invisible-year-##1) at (\yearcolumnwidth, \templength) {};
        }

        \draw ($(invisible-year-##1.east)+(2.5pt, 0pt)$) -- ($(invisible-year-##1.east)+(7.5pt, 0pt)$) -- ($(entry-\entrycounter.west)-(5pt,0)$) -- (entry-\entrycounter.west);
    }

    \begin{tikzpicture}
        \tikzstyle{entry} = [%
            align=left,%
            text width=\entrycolumnwidth,%
            node distance=10mm,%
            anchor=west]
        \tikzstyle{year} = [anchor=east]
        \tikzstyle{timelinerule} = [%
            draw,%
            decoration={markings, mark=at position 1 with {\arrow[scale=1.5]{latex'}}},%
            postaction={decorate},%
            shorten >=0.4pt]

        \drawtimeline
}
{
    \end{tikzpicture}
    \let\startyear\@undefined
    \let\tlendyear\@undefined
    \let\yearcolumnwidth\@undefined
    \let\rulecolumnwidth\@undefined
    \let\entrycolumnwidth\@undefined
    \let\timelineheight\@undefined
    \let\entrycounter\@undefined
    \let\ifnodedefined\@undefined
    \let\ifnodeundefined\@undefined
    \let\drawtimeline\@undefined
    \let\entry\@undefined
}
\makeatother


\begin{document}

\bigskip

\smallskip

\begin{timeline}{1905}{2015}{1.5cm}{4cm}{25cm}{0.45\textheight}
\entry{1905}{Albert Einstein publie sa théorie de la Relativité Restreinte qui décrit l'électrodynamique classique }
\entry{1912}{Vesto M. Slipher découvre grâce au \textit{red-shift} l'éloignement des galaxies spirales de la Terre}
\entry{1915}{Albert Einstein et David Hilbert finalisent la théorie de la Relativité Générale, une théorie relativiste de la gravitation}
\entry{1917}{A. Einstein introduit la constante cosmologique dans l'équation qui porte son nom afin de la rendre compatible avec un univers statique}
\entry{1922}{Alexandre Friedmann publie une théorie décrivant un univers en expansion de courure positive basé sur la Relativité Générale}
\entry{1927}{Georges Lemaître publie un article dans lequel il décrit un univers en expansion homogène isotrope de masse constante et prédit la future "Loi de Hubble" en expliquant la fuite des galaxies par cette expansion }
\entry{1931}{G. Lemaître suggère que l'expansion de l'univers l'a amené d'une taille arbitrairement petite à sa taille actuelle en un temps fini}
\entry{1929}{Découverte de l'expansion de l'univers par Hubble et preuve expérimentale de la loi portant son nom}
\entry{1952}{Walter Baade découvre un nouveau genre d'étoile Céphéide variable, impliquant une correction de la constante de Hubble doublant l'estimation de l'âge de l'univers. }
\entry{1964}{Découverte accidentelle du fond diffus cosmologique par Arno Penzias et Robert Wilson}
\entry{1966}{Rainer K. Sachs et Arthur M. Wolfe décrivent l'effet Sachs-Wolfe, qui relie les fluctuations directionnelles de densité de matière aux fluctuations de température du rayonnement fossile }
\entry{1990}{Des expériences menées grâce au satellite KOBE permettent une mesure précise du spectre du fond diffus cosmologique}
\entry{1998}{Découverte de l'accélération de l'expansion de l'univers}
\entry{1998}{Introduction du terme "Énergie sombre" par Dragan Huterer et Michael S. Turner}
\entry{2015}{Les résultats de l'expérience Planck ... }
\end{timeline}

\end{document}